%!TEX root = ../../common/main.tex

\chapter{The measurement of sin2beta}
\label{ch:measurement_of_sin2beta}

\section{Overview of the measurement ingredients}
\label{sec:measurement_of_sin2beta:overview}
\missing{General idea of the measurement and the key concepts}

\section{Data preparation}
\label{sec:measurement_of_sin2beta:data_preparation}

The presented analysis is performed on a dataset collected by the \LHCb
experiment during two run periods in 2011 and 2012, dubbed
\enquote{\RunOne}\footnote{In contrast to the second \enquote{\RunTwo} period
scheduled to start in 2015 and last until mid 2018.}.

The 2011 subsample has an integrated luminosity of
$\SI[separate-uncertainty=true]{1.00\pm0.04}{\per\femto\barn}$ at a
centre-of-mass energy of $\sqrt{s}=\SI{7}{\TeV}$, while the 2012 subsample has
an integrated luminosity of
$\SI[separate-uncertainty=true]{1.990\pm0.024}{\per\femto\barn}$ at
$\sqrt{s}=\SI{8}{\TeV}$.

The $\BdToJpsiKS$ decay candidates are reconstructed in the $\JpsiToMuMu$ and
$\KSToPiPi$ final state. In order to enhance the purity of the signal
candidates, several selection steps are performed. At first a two-layer
\emph{trigger} system selects events from the \protonproton collisions (\cf
\cref{sec:measurement_of_sin2beta:data_preparation:trigger}). Then a loose and very general
selection, the so called \emph{stripping} is applied to the triggered data
written to tape (\cf
\cref{sec:measurement_of_sin2beta:data_preparation:stripping}). The final step
is an offline selection of the remaining candidates that is further adjusted to
the specific decay and the reconstructed final state (\cf
\cref{sec:measurement_of_sin2beta:data_preparation:offline_selection}).

Besides reducing the background level and enhancing the fraction of signal in
the data set, the selection tries to minimise a possible bias of the measured
\Bd lifetime caused by selection steps that preferably remove candidates with
small decay times. If it is inevitable, then at least the biasing effects should
be understood and accounted for (\cf
\cref{sec:measurement_of_sin2beta:resolution_and_acceptance:acceptance}).

\subsubsection*{Global decay chain fit}
In order to correctly comprise correlations and uncertainties on vertex
positions, particle momenta, flight distances, decay times, and invariant
masses, a global decay chain fit (\acs{DTF}) \cite{Hulsbergen:2005pu} is
performed. Instead of fitting \enquote{leaf-by-leaf} starting from the final
state particles to determine the parameters of their composite mother particle,
then repeating this step until the initial \bhadron is reached, the \DTF fit
extracts all parameters in the decay chain simultaneously.

Entities decorated with the expression \dtfpv stem from a \DTF fit where the
knowledge about the \PV has been used to constrain the production
vertex of the \Bd meson, while the expression \dtf means that additionally to
the \PV constraint the \jpsi and \KS invariant masses are constrained to their
masses listed by the \PDG ($m_{\KS}^{\text{\acs{PDG}}}=\SI{497.614}{\MeVcc}$,
$m_{\jpsi}^{\text{\acs{PDG}}} = \SI[per-mode=symbol]{3096.916}{\MeVcc}$, see
\cite{Agashe:2014kda}) inside the \DTF fit. In the stripping and if not stated
otherwise the much simpler leaf-by-leaf fitting was used.

\subsubsection*{Observables}

Throughout the analysis, several observables are used: the \Bd invariant mass
$\obsMass$, the decay time of the \Bd in its rest frame $\obsTime$, the \Bd
decay time error estimate $\obsTimeError$, and the tag decisions
\obsTagOSSS and mistag estimates \obsEtaOSSS of the opposite site and same side
tagging algorithms (\cf \cref{ch:flavour_tagging}).
\Cref{tab:measurement_of_sin2beta:data_preparation:observables} summarises all
used observables, provides the considered observable ranges, and defines the
used fit constraints.

\begin{table}[!htb]
\centering
\caption{Used observables, observable ranges and \DTF fit properties.\info{checkmark does not work with font}}
\label{tab:measurement_of_sin2beta:data_preparation:observables}
\begin{tabular}{llccc}
\toprule
Name              & Range           & \multicolumn{3}{c}{Fit constraints} \\ 
                  &                 & $m_{\KS}^{\text{PDG}}$ & $m_{\jpsi}^{\text{PDG}}$ & \acs{PV} position \\
\midrule    
$\obsMass$        & $\SIrange[range-phrase = -, range-units = single]{5230}{5330}{\MeVcc}$ & \checkmark & \checkmark & \checkmark \\
$\obsTime$        & $\SIrange[range-phrase = -, range-units = single]{0.3}{18.3}{\pico\second}$ & - & - & \checkmark \\
$\obsTimeError$   & $\SIrange[range-phrase = -, range-units = single]{0.0}{0.2}{\pico\second}$ & - & - & \checkmark \\
$\obsTagOS$       & \num[retain-explicit-plus]{+1}, \num{-1} & - & - & - \\
$\obsEtaOS$       & $\SIrange[range-phrase = -]{0.0}{0.5}{}$ & - & - & - \\
$\obsTagSS$       & \num[retain-explicit-plus]{+1}, \num{-1} & - & - & - \\
$\obsEtaSS$       & $\SIrange[range-phrase = -]{0.0}{0.5}{}$ & - & - & - \\
\bottomrule
\end{tabular}
\end{table}

\subsubsection*{Data set subsamples}

\begin{description}
  \item[Year] The data consists of subsamples from data-taking in both the 2011
and 2012 run periods. To differentiate between these samples, they are indicated
by the terms \textbf{\catOO} and \textbf{\catOT}.

  \item[Track type] Due to the long lifetime of the \KS, its daughter pions may
or may not leave hits in the \VELO (\cf
\cref{sec:lhcb_experiment:tracking:techniques_and_performance}). \KS candidates
(and accordingly the associated \Bmeson candidate) of which both reconstructed
pions have hits in the \VELO are classified as \emph{long track}
(\textbf{\catLL}) candidates. If both pions do not leave hits in the \VELO, the
candidate is called \emph{downstream track} (\textbf{\catDD}) candidate.
Candidates where only one of the reconstructed pions has a long track are not
considered in this analysis.
  
  \item[Tagger] Depending on the tag decisions, events are categorised: as
  exclusively \emph{opposite side tagged} (\textbf{\catOS}) if \textbf{only} the
opposite side tagger combination returns a tag decision, as exclusively
\emph{same side pion tagged} (\textbf{\catSS}) if \textbf{only} the same side
pion tagger returns a decision, as tagged by both tagging algorithms (or
\emph{tagged by both sides} (\textbf{\catBS})), and as \emph{untagged}
(\textbf{\catUT}) if none of the used taggers returns a tag decision. See
\cref{ch:flavour_tagging} for an elaborated description.
  
  \item[Trigger] As described in
\cref{sec:measurement_of_sin2beta:data_preparation:trigger}, the different
trigger lines induce decay time acceptance effects. To describe these effects
independently the data is split into a sample where almost no decay time
acceptance effects are visible, called \emph{almost unbiased} subsample
(\textbf{\catAU}), and a sample that includes the major fraction of events
affected by a decay time acceptance, called \emph{exclusively biased} subsample
(\textbf{\catEB}).
\end{description}

Unless explicitly stated otherwise, no untagged (\textbf{\catUT}) events are
used. Therefore, splitting the data set in all possible categories results in a
total of $\num{24}$ disjoint subsamples.

\subsection{Trigger}
\label{sec:measurement_of_sin2beta:data_preparation:trigger}

The \LHCb trigger system reduces the amount of data to be stored using loose
criteria to filter events with interesting physical signatures. As described in
\cref{sec:lhcb_experiment:trigger} a two-stage system is utilised build up from
the fast hardware-based \acf{LZero} trigger and the software based \acf{HLT}.

The trigger requirements are collected in so called \enquote{trigger lines}
consisting of a set of selections criteria to map certain event types. In the
following the trigger requirements applied in this measurement are described.

If not stated otherwise all candidates passing the requirements specified by the
trigger line configuration \TriggerReq are used in this analysis.

Both the \HLTOneTrackMuon as well as the \HLTTwoDiMuonDetachedJpsi line require
cuts on parameters depending on the candidates' measured decay time, preferably
removing candidates with small decay times. This leads to a bias on the measured
lifetime. Candidates are split into two disjoint subsamples: candidates passing
the requirements given by the trigger line configuration \TriggerReqAU are
classified as \emph{almost unbiased} (\textbf{\catAU}) where else candidates
passing the requirements given by the combination \TriggerReqEB correspond to
the \emph{exclusively biased} subsample (\textbf{\catEB}). The strategy to cope
with this acceptance effects is described in detail in
\cref{sec:measurement_of_sin2beta:resolution_and_acceptance:acceptance}.

\subsubsection{\LZero trigger requirements}
\label{sec:measurement_of_sin2beta:data_preparation:trigger:lzero}

The \HLT lines in use require all candidates pass either the \LZeroMuon or the
\LZeroDiMuon trigger lines. No further \LZero criteria are required.
\missing{L0 trigger cuts}

\subsubsection{\HLTOne trigger requirements}
\label{sec:measurement_of_sin2beta:data_preparation:trigger:hlt1}

All candidates accepted by the two \HLTOne trigger lines are required to carry a
\Jpsi \TOS decision, where \TOS refers to events where the signal particle
tracks alone fulfil the trigger line requirements. Both lines are designed to
trigger on muons, in this case originating from the secondary decay of the \Jpsi
into \mumu. The \HLTOneTrackMuon introduces a bias on the lifetime through a cut
on the minimal muon track \IP with respect to any \PV and is therefore called a
\enquote{biased} line. The \HLTOneDiMuonHighMass does not affect the decay time
distribution, hence is called an \enquote{unbiased} line. All trigger
requirements are summarised in
\cref{tab:measurement_of_sin2beta:data_preparation:trigger:hlt1:cuts}.
%
\begin{table}
\centering
\caption{\HLTOne $\jpsi$ muon lines and their requirements. \cite{Aaij:2012me} }
\label{tab:measurement_of_sin2beta:data_preparation:trigger:hlt1:cuts}
\begin{tabular}{lll}
\toprule
& \HLTOneDiMuonHighMass & \HLTOneTrackMuon \\
\midrule
Track \IP                   & -                                     & $>\SI{0.1}{mm}$ \\
Track $\chi_{\text{\IP}}^2$ & -                                     & $>\num{16}$ \\
Track \pT                   & $>\SI[per-mode=symbol]{0.5}{\GeVc}$   & $>\SI[per-mode=symbol]{1}{\GeVc}$ \\
Track $p$                   & $>\SI[per-mode=symbol]{6}{\GeVc}$     & $>\SI[per-mode=symbol]{8}{\GeVc}$ \\
Track \chisqndf             & $<\num{4}$                            & $<\num{2}$ \\
\DOCA                       & $<\SI{0.2}{mm}$                       & - \\
$\chi^2_\text{vtx}$         & $<\num{25}$                           & - \\
Mass                        & $>\SI[per-mode=symbol]{2.7}{\GeVcc}$  & - \\ 
\bottomrule
\end{tabular}
\end{table}

\subsubsection{\HLTTwo trigger requirements}
\label{sec:measurement_of_sin2beta:data_preparation:trigger:hlt2}

The \HLTTwo trigger line requirements are summarised in
\cref{tab:measurement_of_sin2beta:data_preparation:trigger:hlt2:cuts}. Again a
\TOS decision is required for events passing the trigger selection. Induced by a
cut on the flight distance significance of the \Jpsi candidate the
\HLTTwoDiMuonDetachedJpsi line causes a lifetime bias. Hence, the
\HLTTwoDiMuonJpsi line is used as an unbiased reference line. With a pre-scale
of $\num{0.2}$, only $\SI{20}{\percent}$ of all events passing \LZero and
\HLTTwo are chosen randomly as input to this line.
%
\begin{table}
\centering
\caption{\HLTTwo $\jpsi$ dimuon lines and their requirements ($M_{\jpsi} =
\SI[per-mode=symbol]{3096.916}{\MeVcc}$). \cite{Aaij:2012me} }
\label{tab:measurement_of_sin2beta:data_preparation:trigger:hlt2:cuts}
\begin{tabular}{lll}
\toprule
& \HLTTwoDiMuonJpsi & \HLTTwoDiMuonDetachedJpsi \\
\midrule
Track \chisqndf           & $<\num{5}$                                       & $<\num{5}$ \\
Mass                      & $M_{\jpsi}\pm\SI[per-mode=symbol]{0.12}{\GeVcc}$ & $M_{\jpsi}\pm\SI[per-mode=symbol]{0.12}{\GeVcc}$ \\ 
flight distance $\chi^2$  & -                                                & $>\num{9}$ \\ 
$\chi^2_\text{vtx}$       & $<\num{25}$                                      & $<\num{25}$ \\
\midrule
Pre-scale                 & $\num{0.2}$                                      & - \\
\bottomrule
\end{tabular}
\end{table}

\subsubsection{Trigger efficiencies}
\label{sec:measurement_of_sin2beta:data_preparation:trigger:efficiencies}

The ratio of events passing a trigger requirement compared to all present events
is called trigger efficiency. Compared to the efficiency of the
$\SI{1}{\per\fb}$ \LHCb analysis \cite{Aaij:1497268}, where events had to fulfil
the trigger requirements of the \HLTOneDiMuonHighMass and the
\HLTTwoDiMuonDetachedJpsi lines, a gain of $\SI{19.7}{\percent}$ in signal
efficiency is measured by requiring the
(\HLTOneDiMuonHighMass\VerbOr\HLTOneTrackMuon) decision.
\cref{tab:measurement_of_sin2beta:data_preparation:trigger:efficiencies}
compares the calculated trigger efficiencies in detail.
%
\begin{table}[!htb]
\centering
\caption{Trigger selection efficiencies as determined on (simulated) data. The
first column gives the numbers obtained on $\BdToJpsiKS$ signal MC, where the 
normalisation is performed \wrt events with positive \protect\Verb+L0Physics+,
\protect\Verb+Hl1Phys+, and \protect\Verb+Hlt2Phys+ decisions. The second column shows
\enquote{signal in data} numbers obtained using an \sweighted data sample. The
last column contains numbers extracted from data without distinction between
signal and background.}
\label{tab:measurement_of_sin2beta:data_preparation:trigger:efficiencies}
\begin{scriptsize}
\begin{tabular}{llll}
\toprule
trigger requirements & signal MC & signal in data & overall data \\
\midrule
\HLTOneDiMuonHighMass\VerbAnd\HLTTwoDiMuonDetachedJpsi 
    & \SI{70.3}{\percent} & \SI{72.3}{\percent} & \SI{60.9}{\percent}\\
\TriggerReq 
    & \SI{84.7}{\percent} & \SI{86.6}{\percent} & \SI{74.6}{\percent}\\
\midrule
\text{Difference between trigger requirements}        & \SI{14.4}{pp} & \SI{14.3}{pp} & \SI{13.7}{pp}\\
\text{Relative gain from adding \HLTOneTrackMuon} & +\SI{20.4}{\percent} & +\SI{19.7}{\percent} & +\SI{22.5}{\percent}\\
\bottomrule
\end{tabular}
\end{scriptsize}
\end{table}

\clearpage
\subsection{Stripping}
\label{sec:measurement_of_sin2beta:data_preparation:stripping}
Stripping details, cuts, ...

\subsection{Offline selection}
\label{sec:measurement_of_sin2beta:data_preparation:offline_selection}
Selection cuts, FoM, efficiencies

\subsection{Multiple candidates}
Why do we see multiple candidates, difference between multiple PVs and multiple B candidates, how to remove them

\subsection{Simulated data}
Data sets used, software stack and versions, simulation conditions, DEC file, generation parameters

\section{Flavour tagging}
\label{sec:measurement_of_sin2beta:flavour_tagging}
\section{Backgrounds}
\label{sec:measurement_of_sin2beta:physic_backgrounds}
\section{Decay time resolution and acceptance}
\label{sec:measurement_of_sin2beta:resolution_and_acceptance}
\subsection{Resolution}
\label{sec:measurement_of_sin2beta:resolution_and_acceptance:resolution}
\subsection{Acceptance}
\label{sec:measurement_of_sin2beta:resolution_and_acceptance:acceptance}
\section{Likelihood fit}
\subsection{Fitter validation}
\section{CPV measurement}
\subsection{Fit results}
\subsection{Kaon regeneration}
\section{Study of systematic effects}
\subsection{Cross-checks}
\subsection{Systematics}
\subsection{Summary of systematic effects}
